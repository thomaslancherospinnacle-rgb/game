<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modular Character Generator</title>
    
    <link rel="stylesheet" href="css/core.css">

    <link id="load-hair" rel="stylesheet" href="features/hairstyles/afro.css">
    <link id="load-shape" rel="stylesheet" href="features/faceshapes/oval.css">
    <link id="load-eyes" rel="stylesheet" href="features/eyes/default.css">
    <link id="load-brows" rel="stylesheet" href="features/eyebrows/default.css">
    <link id="load-mouth" rel="stylesheet" href="features/mouth/natural.css">
    <link id="load-nose" rel="stylesheet" href="features/nose/default.css">
</head>
<body>

    <div class="container">
        <div class="face-display">
            <div class="head-rig">
                
                <div class="hair-back"></div> 
                <div class="neck"></div>
                <div class="ears">
                    <div class="ear left"></div>
                    <div class="ear right"></div>
                </div>

                <div class="skull">
                    <div class="hair-scalp"></div> <div class="face-features">
                        <div class="brows">
                            <div class="brow left"></div>
                            <div class="brow right"></div>
                        </div>
                        <div class="eyes">
                            <div class="eye left">
                                <div class="iris"><div class="pupil"></div></div>
                                <div class="eyelid-upper"></div>
                            </div>
                            <div class="eye right">
                                <div class="iris"><div class="pupil"></div></div>
                                <div class="eyelid-upper"></div>
                            </div>
                        </div>
                        <div class="nose">
                            <div class="nose-shadow"></div>
                            <div class="nostril left"></div>
                            <div class="nostril right"></div>
                        </div>
                        <div class="mouth"></div>
                    </div>
                </div>

                <div class="hair-bangs"></div>

            </div>
        </div>

        <div class="controls">
            <h2>Character Lab</h2>
            
            <div class="control-group">
                <label>Face Shape</label>
                <select onchange="swapFeature('faceshapes', this.value)">
                    <option value="oval">Oval (Default)</option>
                    <option value="square">Square / Strong</option>
                    <option value="round">Round / Soft</option>
                    <option value="heart">Heart Shape</option>
                    <option value="long">Long / Noble</option>
                </select>
            </div>

            <div class="control-group">
                <label>Hair Style</label>
                <select onchange="swapFeature('hairstyles', this.value)">
                    <option value="afro">Natural Afro</option>
                    <option value="short">Short Spiked</option>
                    <option value="crop">Textured Crop</option>
                    <option value="curly-fade">Curly Fade</option>
                    <option value="pompadour">Pompadour</option>
                    <option value="crew">Crew Cut</option>
                    <option value="part">Side Part</option>
                    <option value="long">Long & Straight</option>
                    <option value="bald">Bald</option>
                </select>
            </div>

            <div class="control-group">
                <label>Lip Style</label>
                <select onchange="swapFeature('mouth', this.value)">
                    <option value="natural">Natural</option>
                    <option value="full">Full / Plump</option>
                    <option value="thin">Thin / Stern</option>
                    <option value="cupid">Cupid's Bow</option>
                    <option value="wide">Wide Smile</option>
                </select>
            </div>

            <div class="control-group">
                <label>Skin Tone</label>
                <select onchange="updateColor('--skin-base', this.value)">
                    <option value="#ffd7ba">Porcelain</option>
                    <option value="#e8b599">Light</option>
                    <option value="#c58c60">Medium</option>
                    <option value="#8b5e45" selected>Tan</option>
                    <option value="#5c3a2f">Deep</option>
                    <option value="#3b241c">Ebony</option>
                </select>
            </div>

            <button onclick="randomize()">Randomize DNA</button>
        </div>
    </div>

    <script>
        // 1. Feature Swapper Engine
        function swapFeature(folderName, fileName) {
            // Map folder names to the ID of the <link> tag
            const idMap = {
                'hairstyles': 'load-hair',
                'faceshapes': 'load-shape',
                'mouth': 'load-mouth',
                'eyes': 'load-eyes',
                'eyebrows': 'load-brows',
                'nose': 'load-nose'
            };

            const linkId = idMap[folderName];
            const linkTag = document.getElementById(linkId);
            
            if (linkTag) {
                linkTag.href = `features/${folderName}/${fileName}.css`;
            } else {
                console.error(`Link tag with ID '${linkId}' not found.`);
            }
        }

        // 2. Color Engine
        function updateColor(varName, colorHex) {
            const r = document.documentElement.style;
            
            // Helper to generate light/dark variants
            const adjust = (hex, amt) => {
                const num = parseInt(hex.replace('#',''), 16);
                let r = (num >> 16) + amt;
                let g = ((num >> 8) & 0x00FF) + amt;
                let b = (num & 0x0000FF) + amt;
                const clamp = val => Math.max(0, Math.min(255, val));
                return `rgb(${clamp(r)},${clamp(g)},${clamp(b)})`;
            }

            r.setProperty(varName, colorHex);
            
            // If skin, update shadow and highlight automatically
            if(varName.includes('skin')) {
                r.setProperty('--skin-shadow', adjust(colorHex, -40));
                r.setProperty('--skin-highlight', adjust(colorHex, 30));
            }
        }
        
        // 3. Randomizer
        function randomize() {
            const selects = document.querySelectorAll('select');
            selects.forEach(s => {
                const randomIdx = Math.floor(Math.random() * s.options.length);
                s.selectedIndex = randomIdx;
                // Trigger the change event
                s.onchange(); 
            });
        }

        // Init colors on load
        updateColor('--skin-base', '#8b5e45');
    </script>
</body>
</html>
